<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>Дома и сектора | Дома | </title>

    <link href="css/bootstrap.min.css" rel="stylesheet">
    <link href="font-awesome/css/font-awesome.css" rel="stylesheet">

    <link href="css/plugins/dataTables/datatables.min.css" rel="stylesheet">
    <link href="css/telemetry_datatables.css" rel="stylesheet">


    <link href="css/animate.css" rel="stylesheet">
    <link href="css/style.css" rel="stylesheet">

    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/select/1.2.2/css/select.dataTables.min.css">
    <link rel="stylesheet" type="text/css" href="js/plugins/datatablesEditor/css/editor.dataTables.min.css">
    <link rel="stylesheet" type="text/css" href="js/plugins/datatablesEditor/examples/resources/syntax/shCore.css">
    <style type="text/css" class="init">

    </style>
    <link rel="stylesheet" href="font-awesome/css/font-awesome.min.css">
    <link rel="stylesheet" href="fonts/liberation-sans-narrow-bold/stylesheet.css">

</head>

<body class="boxed-layout">
<div id="wrapper">
    <nav class="navbar-default navbar-static-side" role="navigation">
        <div class="sidebar-collapse">
            <ul class="nav metismenu" id="side-menu">
                <li class="nav-header">
                    <div class="dropdown profile-element"> <span>
                            <img alt="image" class="img-circle" src="img/profile_small.jpg" />
                             </span>
                        <a data-toggle="dropdown" class="dropdown-toggle" href="#">
                            <span class="clear"> <span class="block m-t-xs"> <strong class="font-bold">Иван Петров</strong>
                             </span> <span class="text-muted text-xs block">Администратор <b class="caret"></b></span> </span> </a>
                        <ul class="dropdown-menu animated fadeInRight m-t-xs">
                            <li><a href="profile.html">Профайл</a></li>
                            <li class="divider"></li>
                            <li><a href="javascript: $.Logout();">Выход</a></li>
                        </ul>
                    </div>
                    <div class="logo-element">
                        IN+
                    </div>
                </li>
                <li>
                    <a href="index.html"><i class="fa fa-th-large"></i><span class="nav-label">Главная</span></a>
                </li>
                <li>
                    <a href="doma_sectora.html"><i class="fa fa-diamond"></i> <span class="nav-label">Дома и сектора</span></a>
                </li>
                <li>
                    <a href="#"><i class="fa fa-bar-chart-o"></i> <span class="nav-label inactive">Начисление</span><span class="fa arrow"></span></a>
                </li>
                <li>
                    <a href="#"><i class="fa fa-bar-chart-o" ></i> <span class="nav-label inactive">Потребление ресурсов</span><span class="fa arrow"></span></a>
                </li>
                <li>
                    <a href="#"><i class="fa fa-envelope inactive"></i> <span class="nav-label inactive">Сообщения жильцов </span><span class="label label-warning pull-right">8</span></a>
                </li>
                <li>
                    <a href="#"><i class="fa fa-envelope"></i> <span class="nav-label inactive">Сообщения системы </span><span class="label label-info pull-right">8</span></a>
                </li>
                <li>
                    <a href="##"><i class="fa fa-desktop"></i> <span class="nav-label">Настройка</span></a>
                    <ul class="nav nav-second-level collapse">
                        <li><a href="#" class="inactive">Реквизиты, счёт</a></li>
                        <li><a href="tariff.html">Тарифы</a></li>
                    </ul>
                </li>
            </ul>

        </div>
    </nav>

    <div id="page-wrapper" class="gray-bg">
        <div class="row border-bottom">
            <nav class="navbar navbar-static-top" role="navigation" style="margin-bottom: 0">
                <div class="navbar-header">
                    <a class="navbar-minimalize minimalize-styl-2 btn btn-primary " href="#"><i class="fa fa-bars"></i> </a>
                </div>
                <ul class="nav navbar-top-links navbar-right">
                    <li>
                        <span class="m-r-sm text-muted welcome-message">Панель администратора</span>
                    </li>
                    <li class="dropdown">
                        <a class="dropdown-toggle count-info" data-toggle="dropdown" href="#">
                            <i class="fa fa-envelope"></i>  <span class="label label-warning">0</span>
                        </a>
                        <ul class="dropdown-menu dropdown-messages">
                            <li>
                                <div class="dropdown-messages-box">
                                    <a href="#" class="pull-left inactive">
                                        <img alt="image" class="img-circle" src="img/a7.jpg">
                                    </a>
                                    <div class="media-body">
                                        <small class="pull-right">46h ago</small>
                                        <strong>Mike Loreipsum</strong> started following <strong>Monica Smith</strong>. <br>
                                        <small class="text-muted">3 days ago at 7:58 pm - 10.06.2014</small>
                                    </div>
                                </div>
                            </li>
                            <li class="divider"></li>
                            <li>
                                <div class="dropdown-messages-box">
                                    <a href="#" class="pull-left inactive">
                                        <img alt="image" class="img-circle" src="img/a4.jpg">
                                    </a>
                                    <div class="media-body ">
                                        <small class="pull-right text-navy">5h ago</small>
                                        <strong>Chris Johnatan Overtunk</strong> started following <strong>Monica Smith</strong>. <br>
                                        <small class="text-muted">Yesterday 1:21 pm - 11.06.2014</small>
                                    </div>
                                </div>
                            </li>
                            <li class="divider"></li>
                            <li>
                                <div class="dropdown-messages-box">
                                    <a href="#" class="pull-left inactive">
                                        <img alt="image" class="img-circle" src="img/profile.jpg">
                                    </a>
                                    <div class="media-body ">
                                        <small class="pull-right">23h ago</small>
                                        <strong>Monica Smith</strong> love <strong>Kim Smith</strong>. <br>
                                        <small class="text-muted">2 days ago at 2:30 am - 11.06.2014</small>
                                    </div>
                                </div>
                            </li>
                            <li class="divider"></li>
                            <li>
                                <div class="text-center link-block">
                                    <a href="#">
                                        <i class="fa fa-envelope"></i> <strong>Read All Messages</strong>
                                    </a>
                                </div>
                            </li>
                        </ul>
                    </li>
                    <li class="dropdown">
                        <a class="dropdown-toggle count-info" data-toggle="dropdown" href="#">
                            <i class="fa fa-bell"></i>  <span class="label label-primary">0</span>
                        </a>
                        <ul class="dropdown-menu dropdown-alerts">
                            <li>
                                <a href="#">
                                    <div>
                                        <i class="fa fa-envelope fa-fw"></i> You have 16 messages
                                        <span class="pull-right text-muted small">4 minutes ago</span>
                                    </div>
                                </a>
                            </li>
                            <li class="divider"></li>
                            <li>
                                <a href="#">
                                    <div>
                                        <i class="fa fa-twitter fa-fw"></i> 3 New Followers
                                        <span class="pull-right text-muted small">12 minutes ago</span>
                                    </div>
                                </a>
                            </li>
                            <li class="divider"></li>
                            <li>
                                <a href="#">
                                    <div>
                                        <i class="fa fa-upload fa-fw"></i> Server Rebooted
                                        <span class="pull-right text-muted small">4 minutes ago</span>
                                    </div>
                                </a>
                            </li>
                            <li class="divider"></li>
                            <li>
                                <div class="text-center link-block">
                                    <a href="#">
                                        <strong>See All Alerts</strong>
                                        <i class="fa fa-angle-right"></i>
                                    </a>
                                </div>
                            </li>
                        </ul>
                    </li>


                    <li>
                        <a href="javascript: $.Logout();">
                            <i class="fa fa-sign-out"></i> Log out
                        </a>
                    </li>
                </ul>

            </nav>
        </div>
        <div class="row wrapper border-bottom white-bg page-heading">
            <div class="col-lg-10">
                <h2 class="dom_address_kv"></h2>
                <ol class="breadcrumb">
                    <li>
                        <a href="index.html">Главная</a>
                    </li>
                    <li>
                        <a>Дома и сектора</a>
                    </li>
                    <li>
                        <a>Дома</a>
                    </li>
                    <li class="active">
                        <strong><span class="dom_address_kv"></span></strong>
                    </li>
                </ol>
            </div>
            <div class="col-lg-2">

            </div>
        </div>
        <div class="wrapper wrapper-content animated fadeInRight">
            <div class="row">
                <div class="col-lg-12">
                    <div class="ibox float-e-margins">
                        <div class="ibox-title">
                            <h5>Данные квартиры / помещения</h5>
                        </div>
                        <div class="ibox-content">

                            <dl>
                                <dd>
                                    <button id="edit">Редактировать</button>
                                </dd>
                                <dd>
                                    <button id="remove">Удалить</button>
                                </dd>

                                <table class="table table-bordered" data-editor-id="13">
                                    <tbody>
                                        <tr>
                                            <th><dt data-editor-label="type">Тип площади:</dt></th>
                                            <td>
                                                <dd data-editor-field="type" data-editor-id="13"></dd>
                                            </td>
                                        </tr>
                                        <tr>
                                            <th><dt data-editor-label="address">Адрес:</dt></th>
                                            <td>
                                                <dd data-editor-field="address"></dd>
                                            </td>
                                        </tr>
                                        <tr>
                                            <th><dt data-editor-label="area">Площадь:</dt></th>
                                            <td>
                                                <dd data-editor-field="area" data-editor-id="13"></dd>
                                            </td>
                                        </tr>
                                        <tr>
                                            <th><dt data-editor-label="owner">Собственник:</dt></th>
                                            <td>
                                                <dd data-editor-field="owner"></dd>
                                            </td>
                                        </tr>
                                        <tr>
                                            <th><dt data-editor-label="phone">Телефон:</dt></th>
                                            <td>
                                                <dd data-editor-field="phone"></dd>
                                            </td>
                                        </tr>
                                        <tr>
                                            <th><dt data-editor-label="tenants">Количество прописанных:</dt></th>
                                            <td>
                                                <dd data-editor-field="tenants"></dd>
                                            </td>
                                        </tr>
                                        <tr>
                                            <th><dt data-editor-label="created">Дата заведения карточки:</dt></th>
                                            <td>
                                                <dd data-editor-field="created"></dd>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </dl>

                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="footer">
            <div class="pull-right">
                Copyright &copy; 2017
            </div>
        </div>

    </div>
</div>


<!-- Mainly scripts -->
<script src="js/jquery-3.1.1.min.js"></script>
<script src="js/plugins/cookie/jquery.cookie.js"></script>
<script src="js/bootstrap.min.js"></script>
<script src="js/plugins/metisMenu/jquery.metisMenu.js"></script>
<script src="js/plugins/slimscroll/jquery.slimscroll.min.js"></script>

<script src="js/plugins/dataTables/datatables.min.js"></script>
<script src="js/plugins/dataTables/Select-1.2.3/js/dataTables.select.min.js"></script>

<!-- Custom and plugin javascript -->
<script src="js/inspinia.js"></script>
<script src="js/plugins/pace/pace.min.js"></script>
<script src="js/common.js"></script>
<script src="js/plugins/dateformat/jquery-dateFormat.js"></script>


<script type="text/javascript" language="javascript" src="https://cdn.datatables.net/buttons/1.4.1/js/dataTables.buttons.min.js">
</script>
<script type="text/javascript" language="javascript" src="js/plugins/datatablesEditor/js/dataTables.editor.min.js">
</script>
<script type="text/javascript" language="javascript" src="js/plugins/datatablesEditor/examples/resources/syntax/shCore.js">
</script>
<script type="text/javascript" language="javascript" src="js/plugins/datatablesEditor/examples/resources/demo.js">
</script>
<script type="text/javascript" language="javascript" src="js/plugins/datatablesEditor/examples/resources/editor-demo.js">
</script>
<script type="text/javascript" language="javascript" class="init">

    var editor; // use a global for the submit and return data rendering in the examples

    $(document).ready(function() {

        // check token
        if ($.cookie('token') == null) {
            window.location.href = "login.html"
        }

        editor = new $.fn.dataTable.Editor( {
            ajax: {
                edit: {
                    type: 'PUT',
                    url:  'https://hometest.appix.ru/api/quarters/' + $.GET("kvart_id"),
                    headers: { 'X-Auth-Token': $.cookie('token') },
                    data: function ( d ) {
                            var dd = Object();
                            dd.type = d.data[$.GET("kvart_id")].type;
                            dd.address = d.data[$.GET("kvart_id")].address;
                            dd.area = d.data[$.GET("kvart_id")].area;
                            dd.owner = d.data[$.GET("kvart_id")].owner;
                            dd.phone = d.data[$.GET("kvart_id")].phone;
                            dd.tenants = d.data[$.GET("kvart_id")].tenants;
                            dd.action = d.action;
                        return(dd);
                    }
                },
                remove: {
                    type: 'DELETE',
                    url:  'https://hometest.appix.ru/api/quarters/' + $.GET("kvart_id"),
                    headers: { 'X-Auth-Token': $.cookie('token') },
                    success :  function(response) {
                        setTimeout(' window.location.href = "dom_details.html?estate_id=' + $.cookie('estate_id') + '"' , 5);
                    },
                    error :  function(response) {
                        console.log('ERROR kvartira_details DELETE');
                        console.log(JSON.stringify(response));
                    }
                }
            },
            fields: [ {
                label: "АйДи дома",
                name: "id",
                type: "hidden"
            }, {
                label: "Тип",
                name: "type",
                type: "select",
                def:  "0",
                ipOpts: [
                    {"label" : "Жилая площадь", "value" : "1"},
                    {"label" : "Нежилая площадь", "value" : "2"}
                ]
            }, {
                label: "Номер квартиры",
                name: "address",
            }, {
                label: "Логин",
                name: "login",
                type: "hidden"
            }, {
                label: "Коунтерс",
                name: "counters",
                type: "hidden"
            }, {
                label: "Площадь помещения:",
                name: "area"
            }, {
                label: "Собственник:",
                name: "owner"
            }, {
                label: "Телефон:",
                name: "phone"
            }, {
                label: "Количество прописанных:",
                name: "tenants"
            }, {
                label: "Креайтед",
                name: "created",
                type: "hidden"
            }
            ],
            i18n: {
                create: {
                    button: "Добавить",
                    title:  "Добавить объект внутри дома",
                    submit: "Добавить объект"
                },
                edit: {
                    button: "Редактировать",
                    title:  "Редактировать объект внутри дома",
                    submit: "Редактировать объект"
                },
                remove: {
                    button: "Удалить",
                    title:  "Удалить объект",
                    submit: "Удалить объект",
                    confirm: {
                        _: "Подтвердить удаление?",
                        1: "Подтвердить удаление?"
                    }
                }
            }
        } );


        var kvartira_details = new Object();
        function updateKvartDetails(kvartira_details)    {
            if(kvartira_details.type == 1) $("dd[data-editor-field='type']").html('Жилая площадь');
            if(kvartira_details.type == 2) $("dd[data-editor-field='type']").html('Нежилая площадь');
            $("dd[data-editor-field='address']").html($.cookie('estate_address') + ', кв. ' + kvartira_details.address);
            $("dd[data-editor-field='area']").html(kvartira_details.area + ' кв.м');
            $("dd[data-editor-field='owner']").html(kvartira_details.owner);
            $("dd[data-editor-field='phone']").html(kvartira_details.phone);
            $("dd[data-editor-field='tenants']").html(kvartira_details.tenants);
            $("dd[data-editor-field='created']").html($.format.date(kvartira_details.created, "dd.MM.yyyy"));
        }

        $('#edit').on( 'click', function () {
            editor
                    .title('Edit record')
                    .buttons( {
                        label: "Save",
                        fn: function () {
                            this.submit(
                                    function () {
                                        $.ajax({
                                            type : 'GET',
                                            url  : 'https://hometest.appix.ru/api/quarters/' + $.GET("kvart_id"),
                                            beforeSend: function(xhr){
                                                xhr.setRequestHeader('X-Auth-Token', $.cookie('token'));
                                            },
                                            success :  function(response) {
                                                if(response.id > 0)  {
                                                    kvartira_details = response;
                                                    updateKvartDetails(kvartira_details);
                                                }
                                                else {
                                                    console.log('NO kvartira_details updates');
                                                }
                                            },
                                            error :  function(response) {
                                                console.log('ERROR kvartira_details()');
                                                console.log(JSON.stringify(response));
                                            }
                                        });
                                    },
                                    function () {
                                        console.log( 'Form  encountered an error :-(' );
                                    }
                            );
                        }
                    } )
                    .edit($.GET("kvart_id"))
                    .set(kvartira_details);
        });

        $('#remove').on( 'click', function () {
            editor
                    .title('Delete record')
                    .buttons('Delete')
                    .message('Are you sure you wish to delete this record?')
                    .remove( $.GET("kvart_id") );
        } );


        $.ajax({
            type : 'GET',
            url  : 'https://hometest.appix.ru/api/quarters/' + $.GET("kvart_id"),
            beforeSend: function(xhr){
                xhr.setRequestHeader('X-Auth-Token', $.cookie('token'));
            },
            success :  function(response) {
                if(response.id > 0)  {
                    kvartira_details = response;
                    updateKvartDetails(kvartira_details);
                }
                else {
                    console.log('NO kvartira_details updates');
                }
            },
            error :  function(response) {
                console.log('ERROR GetResourcesList()');
                console.log(JSON.stringify(response));
            }
        });
    } );
</script>
</body>
</html>
