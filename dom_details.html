<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>Дома и сектора | Дома | </span></title>

    <link href="css/bootstrap.min.css" rel="stylesheet">
    <link href="font-awesome/css/font-awesome.css" rel="stylesheet">

    <link href="css/plugins/dataTables/datatables.min.css" rel="stylesheet">
    <link href="css/telemetry_datatables.css" rel="stylesheet">


    <link href="css/animate.css" rel="stylesheet">
    <link href="css/style.css" rel="stylesheet">

    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/select/1.2.2/css/select.dataTables.min.css">
    <link rel="stylesheet" type="text/css" href="datatables_editor/css/editor.dataTables.min.css">
    <link rel="stylesheet" type="text/css" href="datatables_editor/examples/resources/syntax/shCore.css">
    <style type="text/css" class="init">

    </style>
    <link rel="stylesheet" href="font-awesome/css/font-awesome.min.css">
    <link rel="stylesheet" href="fonts/liberation-sans-narrow-bold/stylesheet.css">

</head>

<body class="boxed-layout">
<div id="wrapper">
    <nav class="navbar-default navbar-static-side" role="navigation">
        <div class="sidebar-collapse">
            <ul class="nav metismenu" id="side-menu">
                <li class="nav-header">
                    <div class="dropdown profile-element"> <span>
                            <img alt="image" class="img-circle" src="img/profile_small.jpg" />
                             </span>
                        <a data-toggle="dropdown" class="dropdown-toggle" href="#">
                            <span class="clear"> <span class="block m-t-xs"> <strong class="font-bold">Иван Петров</strong>
                             </span> <span class="text-muted text-xs block">Администратор <b class="caret"></b></span> </span> </a>
                        <ul class="dropdown-menu animated fadeInRight m-t-xs">
                            <li><a href="profile.html">Профайл</a></li>
                            <li class="divider"></li>
                            <li><a href="javascript: $.Logout();">Выход</a></li>
                        </ul>
                    </div>
                    <div class="logo-element">
                        IN+
                    </div>
                </li>
                <li>
                    <a href="index.html"><i class="fa fa-th-large"></i><span class="nav-label">Главная</span></a>
                </li>
                <li>
                    <a href="doma_sectora.html"><i class="fa fa-diamond"></i> <span class="nav-label">Дома и сектора</span></a>
                </li>
                <li>
                    <a href="#"><i class="fa fa-bar-chart-o"></i> <span class="nav-label">Начисление</span><span class="fa arrow"></span></a>
                </li>
                <li>
                    <a href="#"><i class="fa fa-bar-chart-o"></i> <span class="nav-label">Потребление ресурсов</span><span class="fa arrow"></span></a>
                </li>
                <li>
                    <a href="mailbox.html"><i class="fa fa-envelope"></i> <span class="nav-label">Сообщения жильцов </span><span class="label label-warning pull-right">8</span></a>
                </li>
                <li>
                    <a href="mailbox.html"><i class="fa fa-envelope"></i> <span class="nav-label">Сообщения системы </span><span class="label label-info pull-right">8</span></a>
                </li>
                <li>
                    <a href="#"><i class="fa fa-desktop"></i> <span class="nav-label">Настройка</span></a>
                    <ul class="nav nav-second-level collapse">
                        <li><a href="contacts.html">Реквизиты, счёт</a></li>
                        <li><a href="tariff.html">Тарифы</a></li>
                    </ul>
                </li>
            </ul>

        </div>
    </nav>

    <div id="page-wrapper" class="gray-bg">
        <div class="row border-bottom">
            <nav class="navbar navbar-static-top" role="navigation" style="margin-bottom: 0">
                <div class="navbar-header">
                    <a class="navbar-minimalize minimalize-styl-2 btn btn-primary " href="#"><i class="fa fa-bars"></i> </a>
                </div>
                <ul class="nav navbar-top-links navbar-right">
                    <li>
                        <span class="m-r-sm text-muted welcome-message">Панель администратора</span>
                    </li>
                    <li class="dropdown">
                        <a class="dropdown-toggle count-info" data-toggle="dropdown" href="#">
                            <i class="fa fa-envelope"></i>  <span class="label label-warning">16</span>
                        </a>
                        <ul class="dropdown-menu dropdown-messages">
                            <li>
                                <div class="dropdown-messages-box">
                                    <a href="profile.html" class="pull-left">
                                        <img alt="image" class="img-circle" src="img/a7.jpg">
                                    </a>
                                    <div class="media-body">
                                        <small class="pull-right">46h ago</small>
                                        <strong>Mike Loreipsum</strong> started following <strong>Monica Smith</strong>. <br>
                                        <small class="text-muted">3 days ago at 7:58 pm - 10.06.2014</small>
                                    </div>
                                </div>
                            </li>
                            <li class="divider"></li>
                            <li>
                                <div class="dropdown-messages-box">
                                    <a href="profile.html" class="pull-left">
                                        <img alt="image" class="img-circle" src="img/a4.jpg">
                                    </a>
                                    <div class="media-body ">
                                        <small class="pull-right text-navy">5h ago</small>
                                        <strong>Chris Johnatan Overtunk</strong> started following <strong>Monica Smith</strong>. <br>
                                        <small class="text-muted">Yesterday 1:21 pm - 11.06.2014</small>
                                    </div>
                                </div>
                            </li>
                            <li class="divider"></li>
                            <li>
                                <div class="dropdown-messages-box">
                                    <a href="profile.html" class="pull-left">
                                        <img alt="image" class="img-circle" src="img/profile.jpg">
                                    </a>
                                    <div class="media-body ">
                                        <small class="pull-right">23h ago</small>
                                        <strong>Monica Smith</strong> love <strong>Kim Smith</strong>. <br>
                                        <small class="text-muted">2 days ago at 2:30 am - 11.06.2014</small>
                                    </div>
                                </div>
                            </li>
                            <li class="divider"></li>
                            <li>
                                <div class="text-center link-block">
                                    <a href="mailbox.html">
                                        <i class="fa fa-envelope"></i> <strong>Read All Messages</strong>
                                    </a>
                                </div>
                            </li>
                        </ul>
                    </li>
                    <li class="dropdown">
                        <a class="dropdown-toggle count-info" data-toggle="dropdown" href="#">
                            <i class="fa fa-bell"></i>  <span class="label label-primary">8</span>
                        </a>
                        <ul class="dropdown-menu dropdown-alerts">
                            <li>
                                <a href="mailbox.html">
                                    <div>
                                        <i class="fa fa-envelope fa-fw"></i> You have 16 messages
                                        <span class="pull-right text-muted small">4 minutes ago</span>
                                    </div>
                                </a>
                            </li>
                            <li class="divider"></li>
                            <li>
                                <a href="profile.html">
                                    <div>
                                        <i class="fa fa-twitter fa-fw"></i> 3 New Followers
                                        <span class="pull-right text-muted small">12 minutes ago</span>
                                    </div>
                                </a>
                            </li>
                            <li class="divider"></li>
                            <li>
                                <a href="grid_options.html">
                                    <div>
                                        <i class="fa fa-upload fa-fw"></i> Server Rebooted
                                        <span class="pull-right text-muted small">4 minutes ago</span>
                                    </div>
                                </a>
                            </li>
                            <li class="divider"></li>
                            <li>
                                <div class="text-center link-block">
                                    <a href="notifications.html">
                                        <strong>See All Alerts</strong>
                                        <i class="fa fa-angle-right"></i>
                                    </a>
                                </div>
                            </li>
                        </ul>
                    </li>


                    <li>
                        <a href="javascript: $.Logout();">
                            <i class="fa fa-sign-out"></i> Log out
                        </a>
                    </li>
                </ul>

            </nav>
        </div>
        <div class="row wrapper border-bottom white-bg page-heading">
            <div class="col-lg-10">
                <h2 class="dom_address"></h2>
                <ol class="breadcrumb">
                    <li>
                        <a href="index.html">Главная</a>
                    </li>
                    <li>
                        <a>Дома и сектора</a>
                    </li>
                    <li>
                        <a>Дома</a>
                    </li>
                    <li class="active">
                        <strong><span class="dom_address"></span></strong>
                    </li>
                </ol>
            </div>
            <div class="col-lg-2">

            </div>
        </div>
        <div class="wrapper wrapper-content animated fadeInRight">
            <div class="row">
                <div class="col-lg-12">
                    <div class="ibox float-e-margins">
                        <div class="ibox-title">
                            <h5>Объекты внутри дома по адресу: <span class="dom_address"></span></h5>
                        </div>
                        <div class="ibox-content">
                            <div class="table-responsive">
                                <table id="example" class="table table-striped table-bordered table-hover dataTables-example" >
                                    <thead>
                                        <tr>
                                            <th>Айди</th>
                                            <th>Тайп</th>
                                            <th>Объекты внутри дома</th>
                                            <th>Логин</th>
                                            <th>Учёт</th>
                                        </tr>
                                    </thead>
                                    <tfoot>
                                        <tr>
                                            <th>Айди</th>
                                            <th>Тайп</th>
                                            <th>Объекты внутри дома</th>
                                            <th>Логин</th>
                                            <th>Учёт</th>
                                        </tr>
                                    </tfoot>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="footer">
            <div class="pull-right">
                Copyright &copy; 2017
            </div>
        </div>

    </div>
</div>


<!-- Mainly scripts -->
<script src="js/jquery-3.1.1.min.js"></script>
<script src="js/plugins/cookie/jquery.cookie.js"></script>
<script src="js/bootstrap.min.js"></script>
<script src="js/plugins/metisMenu/jquery.metisMenu.js"></script>
<script src="js/plugins/slimscroll/jquery.slimscroll.min.js"></script>

<script src="js/plugins/dataTables/datatables.min.js"></script>
<script src="js/plugins/dataTables/Select-1.2.3/js/dataTables.select.min.js"></script>

<!-- Custom and plugin javascript -->
<script src="js/inspinia.js"></script>
<script src="js/plugins/pace/pace.min.js"></script>
<script src="js/common.js"></script>


<script type="text/javascript" language="javascript" src="https://cdn.datatables.net/buttons/1.4.1/js/dataTables.buttons.min.js">
</script>
<script type="text/javascript" language="javascript" src="datatables_editor/js/dataTables.editor.min.js">
</script>
<script type="text/javascript" language="javascript" src="datatables_editor/examples/resources/syntax/shCore.js">
</script>
<script type="text/javascript" language="javascript" src="datatables_editor/examples/resources/demo.js">
</script>
<script type="text/javascript" language="javascript" src="datatables_editor/examples/resources/editor-demo.js">
</script>
<script type="text/javascript" language="javascript" class="init">

    var editor; // use a global for the submit and return data rendering in the examples

    $(document).ready(function() {

        // check token
        if ($.cookie('token') == null) {
            window.location.href = "login.html"
        }

        editor = new $.fn.dataTable.Editor( {
            idSrc: "id",
            ajax: {
                create: {
                    type: 'POST',
                    url:  'https://hometest.appix.ru/api/quarters',
                    headers: { 'X-Auth-Token': $.cookie('token') },
                    data: function ( d ) {
                        var dd = Object();
                        dd.estate_id = $.GET("estate_id");
                        dd.type = d.data[0].type;
                        dd.address = d.data[0].address;
                        dd.area = d.data[0].area;
                        dd.owner = d.data[0].owner;
                        dd.phone = d.data[0].phone;
                        dd.tenants = d.data[0].tenants;
                        dd.action = d.action;
                        return (dd);
                    }
                },
                edit: {
                    type: 'PUT',
                    url:  'https://hometest.appix.ru/api/quarters/_id_',
                    headers: { 'X-Auth-Token': $.cookie('token') },
                    data: function ( d ) {
                        var dd = Object();
                        dd.res = d.data[editor.val( 'id' )].id;
                        dd.res = d.data[editor.val( 'id' )].res;
                        dd.res_name = d.data[editor.val( 'id' )].res_name;
                        dd.name = d.data[editor.val( 'id' )].name;
                        dd.units = d.data[editor.val( 'id' )].units;
                        dd.price = d.data[editor.val( 'id' )].price;
                        dd.action = d.action;
                        return(dd);
                    },
                    dataType: "json"
                },
                remove: {
                    type: 'DELETE',
                    url:  'https://hometest.appix.ru/api/quarters/_id_',
                    headers: { 'X-Auth-Token': $.cookie('token') },
                    /*data: function ( d ) {
                     console.log('DATA');
                     console.log(d);
                     var dd = Object();
                     dd.res = d.data[editor.val( 'id' )].id;
                     dd.res = d.data[editor.val( 'id' )].res;
                     dd.res_name = d.data[editor.val( 'id' )].res_name;
                     dd.name = d.data[editor.val( 'id' )].name;
                     dd.units = d.data[editor.val( 'id' )].units;
                     dd.price = d.data[editor.val( 'id' )].price;
                     dd.action = d.action;
                     return(dd);
                     },
                     dataType: "json"*/
                }
            },

            table: "#example",
            fields: [ {
                label: "АйДи дома",
                name: "estate_id",
                type: "hidden"
            }, {
                label: "Тип",
                name: "type",
                type: "select",
                def:  "0",
                ipOpts: [
                    {"label" : "Жилая площадь", "value" : "1"},
                    {"label" : "Нежилая площадь", "value" : "2"}
                ]
            }, {
                label: "Номер квартиры",
                name: "address",
            }, {
                label: "Площадь помещения:",
                name: "area"
            }, {
                label: "Собственник:",
                name: "owner"
            }, {
                label: "Телефон:",
                name: "phone"
            }, {
                label: "Количество прописанных:",
                name: "tenants"
            }
            ],
            i18n: {
                create: {
                    button: "Добавить",
                    title:  "Добавить объект внутри дома",
                    submit: "Добавить объект"
                },
                edit: {
                    button: "Редактировать",
                    title:  "Редактировать объект внутри дома",
                    submit: "Редактировать объект"
                },
                remove: {
                    button: "Удалить",
                    title:  "Удалить объект",
                    submit: "Удалить объект",
                    confirm: {
                        _: "Подтвердить удаление?",
                        1: "Подтвердить удаление?"
                    }
                }
            }
        } );


/*
        // $.Resources is populated
        $.GetResourcesList();

        // update 'res' selector into the editor popup
        editor.on( 'initCreate', function ( e) {
            editor.field('res').update($.Resources );
        });

        editor.on( 'initEdit', function ( e) {
            editor.field('res').update($.Resources );
        });


        editor.on( 'preSubmit', function ( e) {
            editor.field( 'res_name' ).set( editor.get( 'res' ));
        });
*/



        editor.on('close', function(e) {
            $('#example').DataTable().ajax.reload();
        });

        $('#example').DataTable({
            "columnDefs": [
                {
                    "targets": [ 0 ],
                    "visible": false,
                    "searchable": false
                },
                {
                    "targets": [ 1 ],
                    "visible": false,
                    "searchable": false
                }
            ],
            "language": {
                "url": "//cdn.datatables.net/plug-ins/1.10.16/i18n/Russian.json"
            },
            pageLength: 25,
            responsive: true,
            dom: '<"html5buttons"B>Tfgt<"bottom"lp>',
            ajax: {
                "url": "https://hometest.appix.ru/api/quarters?table=1&estate_id=" + $.GET("estate_id"),
                "beforeSend": function (xhr) {
                    console.log('token = ' + $.cookie('token'));
                    xhr.setRequestHeader('X-Auth-Token', $.cookie('token'));
                },
                "dataSrc": function ( json ) {
                    console.log(json);
                    if(json.status == "error" && json.code == 401)  {
                        setTimeout(' window.location.href = "login.html"; ', 10);
                    }
                    else {
                        return json.data;
                    }
                }
            },
            columns: [
                {data: "id"},
                {data: "type"},
                {data: "address"},
                {data: "login"},
                {data: "counters"}
            ],
            select: true,
            buttons: [
                {extend: "create", editor: editor},
                {extend: "edit", editor: editor},
                {extend: "remove", editor: editor},
                {extend: 'excel', title: 'ExampleFile'},
                {extend: 'pdf', title: 'ExampleFile'},
                {
                    extend: 'print',
                    customize: function (win) {
                        $(win.document.body).addClass('white-bg');
                        $(win.document.body).css('font-size', '10px');

                        $(win.document.body).find('table')
                                .addClass('compact')
                                .css('font-size', 'inherit');
                    }
                }
            ]
        });

        $.ajax({
            type : 'GET',
            url  : 'https://hometest.appix.ru/api/estates/' + $.GET("estate_id"),
            beforeSend: function(xhr){
                xhr.setRequestHeader('X-Auth-Token', $.cookie('token'));
            },
            success :  function(response) {
                if(response.id > 0)  {
                    $(".dom_address").html(response.address);
                    $("title").html("Дома и сектора | Дома | " + response.address);
                }
                else {
                    console.log('NO $(".dom_address") updates');
                }
            },
            error :  function(response) {
                console.log('ERROR GetResourcesList()');
                console.log(JSON.stringify(response));
            }
        });


    } );


</script>
</body>
</html>
